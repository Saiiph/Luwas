{% extends 'general/base.html' %}
{% load static %}

{% block title %}Incident Report Detail{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'incident_detail.css' %}">
{% endblock %}

{% block content %}
<div class="incident-detail-container">
    <div class="incident-header">
        <h1>Incident Report Detail {{ incident.reportid }}</h1>
    </div>

    <div class="incident-body">
        <!-- Left side: Map and Location Details -->
        <div class="left-side">
            <!-- Toggle Buttons -->
            <div class="map-toggle-buttons">
                <button id="nominatim-btn" class="toggle-btn active" onclick="showMap('nominatim')">Nominatim Map</button>
                <button id="streetview-btn" class="toggle-btn" onclick="showMap('streetview')">Street View</button>
            </div>

            <!-- Nominatim/OpenStreetMap Embed -->
            <div id="nominatim-map" class="map-container">
                <iframe
                    src="https://www.openstreetmap.org/export/embed.html?bbox={{ incident.longitude|floatformat:5 }}%2C{{ incident.latitude|floatformat:5 }}%2C{{ incident.longitude|floatformat:5 }}%2C{{ incident.latitude|floatformat:5 }}&layer=mapnik&marker={{ incident.latitude }}%2C{{ incident.longitude }}"
                    allowfullscreen>
                </iframe>
            </div>

            <!-- Google Street View Embed -->
            <div id="streetview-map" class="map-container" style="display: none;">
                <iframe
                    src="https://www.google.com/maps/embed?pb=!1m0!3m2!1sen!2sus!4v0!6m8!1m7!1sCAoSLEFGMVFpcFBxRzJXZW9LUVlfNjU4aF9fZmMxa0FCWmVpdmFSRk5MR0Q0!2m2!1d{{ incident.latitude }}!2d{{ incident.longitude }}!3f0!4f0!5f1.2"
                    allowfullscreen>
                </iframe>
            </div>

            <!-- Location, Latitude, Longitude -->
            <div class="location-info">
                <div>{{ incident.location }}</div>
            </div>
        </div>

        <!-- Right side: Remaining Information -->
        <div class="right-side">
            <div class="incident-info">
                <div class="incident-info-item">
                    <span class="label">Incident ID:</span> {{ incident.reportid }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Incident Type:</span> {{ incident.incident_type }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Severity:</span> {{ incident.severity }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Category:</span> {{ incident.category }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Status:</span> {{ incident.status }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Timestamp:</span> {{ incident.timestamp }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Latitude:</span> {{ incident.latitude }}
                </div>
                <div class="incident-info-item">
                    <span class="label">Longitude:</span> {{ incident.longitude }}
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                {% if is_assigned %}
                    <a href="{% url 'incident_update' incident.pk %}"><button class="update">Update</button></a>
                    <a href="{% url 'incident_delete' incident.pk %}"><button class="delete">Delete</button></a>
                {% endif %}
                <a href="{% url 'incident_list' %}"><button class="back">Back to List</button></a>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for toggling maps -->
<script>
    function showMap(mapType) {
        const nominatimMap = document.getElementById('nominatim-map');
        const streetviewMap = document.getElementById('streetview-map');
        const nominatimBtn = document.getElementById('nominatim-btn');
        const streetviewBtn = document.getElementById('streetview-btn');

        if (mapType === 'nominatim') {
            nominatimMap.style.display = 'block';
            streetviewMap.style.display = 'none';
            nominatimBtn.classList.add('active');
            streetviewBtn.classList.remove('active');
        } else if (mapType === 'streetview') {
            nominatimMap.style.display = 'none';
            streetviewMap.style.display = 'block';
            streetviewBtn.classList.add('active');
            nominatimBtn.classList.remove('active');
        }
    }
</script>

<style>
    .map-toggle-buttons {
        margin-bottom: 10px;
        display: flex;
        gap: 10px;
    }

    .toggle-btn {
        padding: 12px 20px;
        font-size: 1rem;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        background-color: #FF5A5F; /* Coral primary */
        color: white;
        transition: transform 0.3s ease, background-color 0.3s ease;
    }

    .toggle-btn.active {
        background-color: #D84044; /* Darker coral for active state */
    }

    .toggle-btn:hover {
        transform: translateY(-2px);
        background-color: #D84044; /* Darker coral for hover */
    }
</style>

{% endblock %}
